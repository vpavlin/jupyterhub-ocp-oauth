#!/bin/bash

/usr/libexec/s2i/assemble

git clone -b feature/UI https://github.com/mroman-redhat/jupyterhub-singleuser-profiles.git /tmp/src/jsp

cd /tmp/src/jsp/jupyterhub_singleuser_profiles_ui

npm install
npm run build

cd /opt/app-root/share/jupyterhub/static/
mkdir jsp-ui
cp -a /tmp/src/jsp/jupyterhub_singleuser_profiles_ui/build/. /opt/app-root/share/jupyterhub/static/jsp-ui

cd /tmp/src/jsp/jupyterhub_singleuser_profiles_ui/templates/
yes | cp -rf spawn.html page.html /opt/app-root/share/jupyterhub/templates/
cd /tmp/src/jsp/jupyterhub_singleuser_profiles_ui/styles/
yes | cp -rf style.less /opt/app-root/share/jupyterhub/static/less

curl -L -o /opt/app-root/lib/python3.6/site-packages/jupyterhub/services/auth.py https://raw.githubusercontent.com/vpavlin/jupyterhub/bug/remove-auth-args/jupyterhub/services/auth.py

fix-permissions /opt/app-root
